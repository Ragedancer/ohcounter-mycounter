function revealCircle(a) {
    a.getElementsByClassName("circle")[0].classList.add("opened"), setTimeout(function() {
        document.getElementsByClassName("opened")[0].classList.remove("opened");
    }, 550);
}

function rotateIcon(a) {
    var b = a.getElementsByTagName("svg")[0];
    b.classList.contains("spinLeft") ? (b.classList.toggle("spinLeft", !1), b.classList.toggle("spinRight", !0)) : b.classList.contains("spinRight") ? (b.classList.toggle("spinLeft", !0), 
    b.classList.toggle("spinRight", !1)) : b.classList.toggle("spinLeft");
}

function buttonOpenEnterNames() {
    enterPlayerNames(readPlayerNumbers(), null);
}

function buttonOpenGameSelect() {
    readPlayerNames(), openGameSelect(null);
}

function menuOpenDice() {
    toggleHamMenu(), openDice();
}

function buttonPlayGame() {
    startGame(whichIsChecked(document.getElementsByName("game-selection")).value);
}

function newCookie(a, b, c) {
    checkCookie(a) || setCookie(a, b, .0069);
}

function setCookie(a, b, c) {
    null == c && (c = 99999);
    var d = new Date();
    d.setTime(d.getTime() + 24 * c * 60 * 60 * 1e3);
    var e = "expires=" + d.toUTCString();
    document.cookie = a + "=" + JSON.stringify(b) + ";" + e + ";path=/";
}

function getCookie(a) {
    for (var b = a + "=", c = document.cookie.split(";"), d = 0; d < c.length; d++) {
        for (var e = c[d]; " " == e.charAt(0); ) e = e.substring(1);
        if (0 == e.indexOf(b)) return JSON.parse(e.substring(b.length, e.length));
    }
    return "";
}

function checkCookie(a) {
    "" != getCookie(a) ? alert("Continue Game") : newCookie(a);
}

function openDice() {
    document.getElementById("content").innerHTML = "", loadFile("content", "template/dice.html", 1).then(function(a) {
        Promise.all([ loadFileContents("images/dice/d4.svg"), loadFileContents("images/dice/d6.svg"), loadFileContents("images/dice/d8.svg"), loadFileContents("images/dice/d10.svg"), loadFileContents("images/dice/d12.svg"), loadFileContents("images/dice/d20.svg"), loadFileContents("images/dice/Coin.svg") ]).then(function(a) {
            var b = document.getElementById("dice-holder");
            console.log(a);
            for (var c in a) b.appendChild(convertToElement(a[c]).childNodes[0]);
        });
    }), newState("dice");
}

function rollDie(a) {
    var b = Math.floor(Math.random() * a) + 1;
    document.getElementById("result").innerHTML = b;
}

function rollDice() {
    var a = document.getElementById("dice"), b = Math.floor(Math.random() * a.value) + 1;
    document.getElementById("result").innerHTML = b;
}

function coinFlip() {
    var a = Math.floor(2 * Math.random()) + 1;
    document.getElementById("result").innerHTML = 1 == a ? "Heads" : "Tails";
}

function newGame() {
    toggleHamMenu(), openNumPlayerSelect();
}

function openNumPlayerSelect(a) {
    loadFile("templates", "template/num-player-select.html").then(function(b) {
        var c = document.getElementById("content");
        if (c.innerHTML = "", newTemplate("num-players-template", [], c), null !== a.numPlayers) {
            var d = document.getElementsByName("player-selection");
            for (var e in d) "player-option-" + a.numPlayers === d[e].id && (d[e].checked = !0);
        } else newState("numPlayers", newGameCookie);
    }, function(a) {
        console.error("Failed!", a);
    });
}

function readPlayerNumbers() {
    return whichIsChecked(document.getElementsByName("player-selection")).value;
}

function enterPlayerNames(a) {
    var b = document.getElementById("content");
    b.innerHTML = "", newTemplate("player-names-template", [], b);
    for (var c = document.getElementsByClassName("player-names-input")[0], d = 0; d < a.numPlayers; d++) {
        newTemplate("new-name-template", [], c);
        var e = document.getElementById("player");
        e.setAttribute("name", "player" + d), e.setAttribute("id", "player" + d);
        var f = document.getElementById("playerLabel");
        if (f.setAttribute("for", "player" + d), f.setAttribute("id", "playerLabel" + d), 
        null !== a.playerNames) {
            var g = a.playerNames[d];
            e.value = void 0 != g ? g : "";
        }
    }
    null !== a.playerNames && void 0 !== a.playerNames || newState("playerNames", newGameCookie);
}

function readPlayerNames() {
    for (var a = document.getElementsByClassName("player-name"), b = [], c = 0; c < a.length; c++) {
        var d = document.getElementById("player" + c).value;
        b[c] = d;
    }
}

function openGameSelect(a) {
    loadFile("templates", "template/game-select.html").then(function(a) {
        var b = document.getElementById("content");
        b.innerHTML = "", newTemplate("game-selection-template", [], b), loadFileContents("lib/json/game-list.json").then(function(a) {
            for (var b = JSON.parse(a).games, c = document.getElementById("game-selection"), d = 0; d < b.length; d++) {
                newTemplate("game-template", [], c);
                var e = document.getElementById("game-option");
                e.setAttribute("value", b[d].name), e.setAttribute("id", "game-option" + b[d].id), 
                0 === b[d].id && (e.checked = !0);
                var f = document.getElementById("game-option-label");
                f.setAttribute("for", "game-option" + b[d].id), f.setAttribute("id", "game-option-label" + b[d].id), 
                f.innerHTML = b[d].name;
            }
        }, function(a) {
            console.error("Failed to load game-list");
        });
    }, function(a) {
        console.error("Failed to load game-select!", a);
    }), newState("gameSelect", newGameCookie);
}

function startGame(a) {
    document.getElementById("content").innerHTML = "", loadFile("templates", "template/game.html").then(function(b) {
        var c = "games/MTG-Commander.json";
        loadFileContents("lib/json/game-list.json").then(function(b) {
            for (var d = JSON.parse(b).games, e = 0; e < d.length; e++) a === d[e].name && (c = d[e].template);
        }).then(function() {
            loadFileContents("lib/json/" + c).then(function(a) {
                for (var b = JSON.parse(a), c = 0; c < 1; c++) {
                    var d = document.createElement("div");
                    d.setAttribute("id", "player" + c), d.classList.add("player"), 0 === c && d.classList.add("active"), 
                    document.getElementById("content").appendChild(d);
                    var e, f, g, h = b.primary;
                    if (h.increments.length > 1) {
                        e = convertToElement(document.getElementById("p-multi-template").innerHTML), e.getElementsByClassName("counter-name")[0].innerHTML = h.name, 
                        e.getElementsByClassName("counter-value")[0].innerHTML = h.start;
                        for (var i = e.getElementsByClassName("multi-counter")[0], j = 0; j < h.increments.length; j++) f = convertToElement(document.getElementById("increment-group-template").innerHTML), 
                        f.getElementsByClassName("loss")[0].innerHTML = h.increments[j], f.getElementsByClassName("gain")[0].innerHTML = h.increments[j], 
                        appendChildNodes(f, i);
                        appendChildNodes(e, d);
                    } else e = convertToElement(document.getElementById("p-single-template").innerHTML), 
                    e.getElementsByClassName("counter-name")[0].innerHTML = h.name, e.getElementsByClassName("counter-value")[0].innerHTML = h.start, 
                    e.getElementsByClassName("loss")[0].innerHTML = h.increments[0], e.getElementsByClassName("gain")[0].innerHTML = h.increments[0], 
                    appendChildNodes(e, d);
                    for (var k = b.secondary, l = 0; l < k.length; l++) {
                        var m = k[l];
                        if (m.increments.length > 1) {
                            e = convertToElement(document.getElementById("s-multi-template").innerHTML), e.getElementsByClassName("counter-name")[0].innerHTML = m.name, 
                            e.getElementsByClassName("counter-value")[0].innerHTML = m.start;
                            for (var n = e.getElementsByClassName("multi-counter")[0], o = 0; o < m.increments.length; o++) f = convertToElement(document.getElementById("increment-group-template").innerHTML), 
                            f.getElementsByClassName("loss")[0].innerHTML = m.increments[o], f.getElementsByClassName("gain")[0].innerHTML = m.increments[o], 
                            appendChildNodes(f, n);
                            appendChildNodes(e, d);
                        } else e = convertToElement(document.getElementById("s-single-template").innerHTML), 
                        e.getElementsByClassName("counter-name")[0].innerHTML = m.name, e.getElementsByClassName("counter-value")[0].innerHTML = m.start, 
                        g = m.increments[0], e.getElementsByClassName("loss")[0].innerHTML = void 0 !== g ? g : m.increments, 
                        e.getElementsByClassName("gain")[0].innerHTML = void 0 !== g ? g : m.increments, 
                        appendChildNodes(e, d);
                    }
                    for (var p = b.tertiary, q = 0; q < p.length; q++) {
                        var r = p[q];
                        e = convertToElement(document.getElementById("t-single-template").innerHTML), e.getElementsByClassName("counter-name")[0].innerHTML = r.name, 
                        e.getElementsByClassName("counter-value")[0].innerHTML = r.start, g = r.increments[0], 
                        e.getElementsByClassName("loss")[0].innerHTML = void 0 !== g ? g : r.increments, 
                        e.getElementsByClassName("gain")[0].innerHTML = void 0 !== g ? g : r.increments, 
                        appendChildNodes(e, d);
                    }
                }
            });
        });
    }), newState("game-start");
}

function domLoad(a) {
    var b = a.name, c = a.cookie, d = getCookie(c);
    switch (console.log("pop: " + b), b) {
      case "numPlayers":
        openNumPlayerSelect(d);
        break;

      case "playerNames":
        enterPlayerNames(d);
        break;

      case "gameSelect":
        openGameSelect(d);
        break;

      case "dice":
        openDice(d);
    }
}

function newState(a, b) {
    var c = {
        name: a,
        cookie: b
    };
    console.log("push: " + a), history.pushState(c, null, null);
}

function toggleShow(a) {
    document.getElementById(a).classList.toggle("show");
}

function toggleCover(a) {
    document.getElementById(a).classList.toggle("hide");
}

function toggleFabMenu() {
    rotateIcon(document.getElementById("fab")), toggleShow("fab-menu-items"), toggleCover("fab-menu-items-active");
}

function toggleHamMenu() {
    toggleShow("menu"), toggleCover("menu-active");
}

function addPlayer() {
    var a = document.getElementById("name").value, b = document.createElement("p");
    b.setAttribute("class", "player");
    var c = document.createTextNode(a);
    b.appendChild(c), document.getElementById("playerList").appendChild(b);
}

function randPlayer() {
    var a = document.getElementsByClassName("player"), b = a.length, c = Math.floor(Math.random() * b);
    document.getElementById("testArea").innerHTML = a[c].innerHTML;
}

function convertToElement(a) {
    var b = document.createElement("div");
    return b.innerHTML = a, b;
}

function appendChildNodes(a, b) {
    for (;a.firstChild; ) {
        var c = a.firstChild;
        a.removeChild(c), b.appendChild(c);
    }
}

function loadFile(a, b, c) {
    return new Promise(function(d, e) {
        var f = new XMLHttpRequest();
        f.open("GET", b, !0), f.onload = function() {
            200 !== f.status && e(Error(f.statusText));
            var b = document.getElementById(a);
            1 === c ? b.appendChild(convertToElement(f.response).childNodes[0]) : b.appendChild(convertToElement(f.response)), 
            d(f.response);
        }, f.onerror = function() {
            e(Error("Network Error"));
        }, f.send();
    });
}

function loadFileContents(a) {
    return new Promise(function(b, c) {
        var d = new XMLHttpRequest();
        d.open("GET", a, !0), d.onload = function() {
            200 !== d.status && c(Error(d.statusText)), b(d.response);
        }, d.onerror = function() {
            c(Error("Network Error"));
        }, d.send();
    });
}

function newTemplate(a, b, c) {
    var d = document.getElementById(a).innerHTML, e = convertToElement(d);
    for (var f in b) {
        var g = b[f];
        e.getElementsByClassName(f)[0].innerHTML = g;
    }
    appendChildNodes(e, c);
}

function newTemplateArray(a, b, c) {
    for (var d in b) newTemplate(a, b[d], c);
}

function whichIsChecked(a) {
    for (var b = 0; b < a.length; b++) if (a[b].checked) return a[b];
}

var newGameCookie = "GameInitCookie";

document.addEventListener("DOMContentLoaded", function() {
    loadFileContents("lib/json/game-creation-cookie-template.json").then(function(a) {
        var b = JSON.parse(a);
        newCookie(newGameCookie, b, .0069), openNumPlayerSelect(b);
    }), window.addEventListener("popstate", function(a) {
        domLoad(a.state);
    });
});